<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Nazmul Alam" /><link rel="canonical" href="https://github.com/diptu/system-design-multilang/system-desing/crud-app/JS/server/node_modules/mquery/" />
      <link rel="shortcut icon" href="../../../../../../img/favicon.ico" />
    <title>mquery - system-design-multilang</title>
    <link rel="stylesheet" href="../../../../../../css/theme.css" />
    <link rel="stylesheet" href="../../../../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "mquery";
        var mkdocs_page_input_path = "system-desing/crud-app/JS/server/node_modules/mquery/README.md";
        var mkdocs_page_url = "/diptu/system-design-multilang/system-desing/crud-app/JS/server/node_modules/mquery/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../../../../.." class="icon icon-home"> system-design-multilang
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../../../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../../getting-started/">user guide</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">System Design</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../../">Topics</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../../../../LICENSE/">License</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../..">system-design-multilang</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">mquery</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/diptu/system-design-multilang/edit/master/docs/system-desing/crud-app/JS/server/node_modules/mquery/README.md">Edit on diptu/system-design-multilang</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="mquery">mquery</h1>
<p><code>mquery</code> is a fluent mongodb query builder designed to run in multiple environments.</p>
<p><a href="https://travis-ci.org/aheckmann/mquery"><img alt="Build Status" src="https://travis-ci.org/aheckmann/mquery.svg?branch=master" /></a>
<a href="http://badge.fury.io/js/mquery"><img alt="NPM version" src="https://badge.fury.io/js/mquery.svg" /></a></p>
<p><a href="https://www.npmjs.com/package/mquery"><img alt="npm" src="https://nodei.co/npm/mquery.png" /></a></p>
<h2 id="features">Features</h2>
<ul>
<li>fluent query builder api</li>
<li>custom base query support</li>
<li>MongoDB 2.4 geoJSON support</li>
<li>method + option combinations validation</li>
<li>node.js driver compatibility</li>
<li>environment detection</li>
<li><a href="https://github.com/visionmedia/debug">debug</a> support</li>
<li>separated collection implementations for maximum flexibility</li>
</ul>
<h2 id="use">Use</h2>
<div class="language-js highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">mongo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongodb&#39;</span><span class="p">);</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">mongo</span><span class="p">.</span><span class="nx">MongoClient</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="k">await</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="c1">// get a collection</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="kd">const</span><span class="w"> </span><span class="nx">collection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">&#39;artists&#39;</span><span class="p">);</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="c1">// pass it to the constructor</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="k">await</span><span class="w"> </span><span class="nx">mquery</span><span class="p">(</span><span class="nx">collection</span><span class="p">).</span><span class="nx">find</span><span class="p">({...});</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="c1">// or pass it to the collection method</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="kd">const</span><span class="w"> </span><span class="nx">docs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">mquery</span><span class="p">().</span><span class="nx">find</span><span class="p">({...}).</span><span class="nx">collection</span><span class="p">(</span><span class="nx">collection</span><span class="p">);</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="c1">// or better yet, create a custom query constructor that has it always set</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="kd">const</span><span class="w"> </span><span class="nx">Artist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mquery</span><span class="p">(</span><span class="nx">collection</span><span class="p">).</span><span class="nx">toConstructor</span><span class="p">();</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="kd">const</span><span class="w"> </span><span class="nx">docs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Artist</span><span class="p">().</span><span class="nx">find</span><span class="p">(...).</span><span class="nx">where</span><span class="p">(...);</span>
</span></code></pre></div>
<p><code>mquery</code> requires a collection object to work with. In the example above we just pass the collection object created using the official <a href="https://github.com/mongodb/node-mongodb-native">MongoDB driver</a>.</p>
<h2 id="fluent-api">Fluent API</h2>
<ul>
<li><a href="#mquery">mquery</a></li>
<li><a href="#features">Features</a></li>
<li><a href="#use">Use</a></li>
<li><a href="#fluent-api">Fluent API</a></li>
<li><a href="#helpers">Helpers</a><ul>
<li><a href="#find">find()</a></li>
<li><a href="#findone">findOne()</a></li>
<li><a href="#count">count()</a></li>
<li><a href="#findoneandupdate">findOneAndUpdate()</a><ul>
<li><a href="#findoneandupdate-options">findOneAndUpdate() options</a></li>
</ul>
</li>
<li><a href="#findoneandremove">findOneAndRemove()</a><ul>
<li><a href="#findoneandremove-options">findOneAndRemove() options</a></li>
</ul>
</li>
<li><a href="#distinct">distinct()</a></li>
<li><a href="#exec">exec()</a></li>
<li><a href="#stream">stream()</a></li>
<li><a href="#all">all()</a></li>
<li><a href="#and">and()</a></li>
<li><a href="#box">box()</a></li>
<li><a href="#circle">circle()</a></li>
<li><a href="#elemmatch">elemMatch()</a></li>
<li><a href="#equals">equals()</a></li>
<li><a href="#exists">exists()</a></li>
<li><a href="#geometry">geometry()</a></li>
<li><a href="#gt">gt()</a></li>
<li><a href="#gte">gte()</a></li>
<li><a href="#in">in()</a></li>
<li><a href="#intersects">intersects()</a></li>
<li><a href="#lt">lt()</a></li>
<li><a href="#lte">lte()</a></li>
<li><a href="#maxdistance">maxDistance()</a></li>
<li><a href="#mod">mod()</a></li>
<li><a href="#ne">ne()</a></li>
<li><a href="#nin">nin()</a></li>
<li><a href="#nor">nor()</a></li>
<li><a href="#near">near()</a></li>
<li><a href="#example">Example</a></li>
<li><a href="#or">or()</a></li>
<li><a href="#polygon">polygon()</a></li>
<li><a href="#regex">regex()</a></li>
<li><a href="#select">select()</a><ul>
<li><a href="#string-syntax">String syntax</a></li>
</ul>
</li>
<li><a href="#selected">selected()</a></li>
<li><a href="#selectedinclusively">selectedInclusively()</a></li>
<li><a href="#selectedexclusively">selectedExclusively()</a></li>
<li><a href="#size">size()</a></li>
<li><a href="#slice">slice()</a></li>
<li><a href="#within">within()</a></li>
<li><a href="#where">where()</a></li>
<li><a href="#where-1">$where()</a></li>
<li><a href="#batchsize">batchSize()</a></li>
<li><a href="#collation">collation()</a></li>
<li><a href="#comment">comment()</a></li>
<li><a href="#hint">hint()</a></li>
<li><a href="#j">j()</a></li>
<li><a href="#limit">limit()</a></li>
<li><a href="#maxtime">maxTime()</a></li>
<li><a href="#skip">skip()</a></li>
<li><a href="#sort">sort()</a></li>
<li><a href="#read">read()</a><ul>
<li><a href="#preferences">Preferences:</a></li>
<li><a href="#preference-tags">Preference Tags:</a></li>
</ul>
</li>
<li><a href="#readconcern">readConcern()</a><ul>
<li><a href="#read-concern-level">Read Concern Level:</a></li>
</ul>
</li>
<li><a href="#writeconcern">writeConcern()</a><ul>
<li><a href="#write-concern">Write Concern:</a></li>
</ul>
</li>
<li><a href="#slaveok">slaveOk()</a></li>
<li><a href="#tailable">tailable()</a></li>
<li><a href="#wtimeout">wtimeout()</a></li>
</ul>
</li>
<li><a href="#helpers-1">Helpers</a><ul>
<li><a href="#collection">collection()</a></li>
<li><a href="#then">then()</a></li>
<li><a href="#mergeobject">merge(object)</a></li>
<li><a href="#setoptionsoptions">setOptions(options)</a><ul>
<li><a href="#setoptions-options">setOptions() options</a></li>
</ul>
</li>
<li><a href="#settracefunctionfunc">setTraceFunction(func)</a></li>
<li><a href="#mquerysetglobaltracefunctionfunc">mquery.setGlobalTraceFunction(func)</a></li>
<li><a href="#mquerycanmergeconditions">mquery.canMerge(conditions)</a></li>
</ul>
</li>
<li><a href="#mqueryusegeowithin">mquery.use$geoWithin</a></li>
<li><a href="#custom-base-queries">Custom Base Queries</a></li>
<li><a href="#validation">Validation</a></li>
<li><a href="#debug-support">Debug support</a></li>
<li><a href="#general-compatibility">General compatibility</a><ul>
<li><a href="#objectids">ObjectIds</a></li>
<li><a href="#read-preferences">Read Preferences</a></li>
</ul>
</li>
<li><a href="#future-goals">Future goals</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#license">License</a></li>
</ul>
<h2 id="helpers">Helpers</h2>
<ul>
<li><a href="#collection">collection</a></li>
<li><a href="#then">then</a></li>
<li><a href="#mergeobject">merge</a></li>
<li><a href="#setoptionsoptions">setOptions</a></li>
<li><a href="#settracefunctionfunc">setTraceFunction</a></li>
<li><a href="#mquerysetglobaltracefunctionfunc">mquery.setGlobalTraceFunction</a></li>
<li><a href="#mquerycanmergeconditions">mquery.canMerge</a></li>
<li><a href="#mqueryusegeowithin">mquery.use$geoWithin</a></li>
</ul>
<h3 id="find">find()</h3>
<p>Declares this query a <em>find</em> query. Optionally pass a match clause.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">find</span><span class="p">()</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">find</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="k">await</span><span class="w"> </span><span class="nx">mquery</span><span class="p">().</span><span class="nx">find</span><span class="p">()</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">docs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">mquery</span><span class="p">().</span><span class="nx">find</span><span class="p">(</span><span class="nx">match</span><span class="p">);</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="nx">assert</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">docs</span><span class="p">));</span>
</span></code></pre></div>
<h3 id="findone">findOne()</h3>
<p>Declares this query a <em>findOne</em> query. Optionally pass a match clause.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">findOne</span><span class="p">()</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">findOne</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="k">await</span><span class="w"> </span><span class="nx">mquery</span><span class="p">().</span><span class="nx">findOne</span><span class="p">()</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">mquery</span><span class="p">().</span><span class="nx">findOne</span><span class="p">(</span><span class="nx">match</span><span class="p">);</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">  </span><span class="c1">// the document may not be found</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="count">count()</h3>
<p>Declares this query a <em>count</em> query. Optionally pass a match clause.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">count</span><span class="p">()</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">count</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="k">await</span><span class="w"> </span><span class="nx">mquery</span><span class="p">().</span><span class="nx">count</span><span class="p">()</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">mquery</span><span class="p">().</span><span class="nx">count</span><span class="p">(</span><span class="nx">match</span><span class="p">);</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;we found %d matching documents&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">number</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="findoneandupdate">findOneAndUpdate()</h3>
<p>Declares this query a <em>findAndModify</em> with update query. Optionally pass a match clause, update document, options.</p>
<p>When executed, the first matching document (if found) is modified according to the update document and passed back.</p>
<h4 id="findoneandupdate-options">findOneAndUpdate() options</h4>
<p>Options are passed to the <code>setOptions()</code> method.</p>
<ul>
<li><code>returnDocument</code>: string - <code>'after'</code> to return the modified document rather than the original. defaults to <code>'before'</code></li>
<li><code>upsert</code>: boolean - creates the object if it doesn't exist. defaults to false</li>
<li><code>sort</code>: if multiple docs are found by the match condition, sets the sort order to choose which doc to update</li>
</ul>
<div class="language-js highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nx">query</span><span class="p">.</span><span class="nx">findOneAndUpdate</span><span class="p">()</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="nx">query</span><span class="p">.</span><span class="nx">findOneAndUpdate</span><span class="p">(</span><span class="nx">updateDocument</span><span class="p">)</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="nx">query</span><span class="p">.</span><span class="nx">findOneAndUpdate</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span><span class="w"> </span><span class="nx">updateDocument</span><span class="p">)</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="nx">query</span><span class="p">.</span><span class="nx">findOneAndUpdate</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span><span class="w"> </span><span class="nx">updateDocument</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">)</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="c1">// the following all execute the command</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="k">await</span><span class="w"> </span><span class="nx">query</span><span class="p">.</span><span class="nx">findOneAndUpdate</span><span class="p">()</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="k">await</span><span class="w"> </span><span class="nx">query</span><span class="p">.</span><span class="nx">findOneAndUpdate</span><span class="p">(</span><span class="nx">updateDocument</span><span class="p">)</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="k">await</span><span class="w"> </span><span class="nx">query</span><span class="p">.</span><span class="nx">findOneAndUpdate</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span><span class="w"> </span><span class="nx">updateDocument</span><span class="p">)</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="kd">const</span><span class="w"> </span><span class="nx">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">query</span><span class="p">.</span><span class="nx">findOneAndUpdate</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span><span class="w"> </span><span class="nx">updateDocument</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">);</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">  </span><span class="c1">// the document may not be found</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="findoneandremove">findOneAndRemove()</h3>
<p>Declares this query a <em>findAndModify</em> with remove query. Alias of findOneAndDelete.
Optionally pass a match clause, options.</p>
<p>When executed, the first matching document (if found) is modified according to the update document, removed from the collection and passed as a result.</p>
<h4 id="findoneandremove-options">findOneAndRemove() options</h4>
<p>Options are passed to the <code>setOptions()</code> method.</p>
<ul>
<li><code>sort</code>: if multiple docs are found by the condition, sets the sort order to choose which doc to modify and remove</li>
</ul>
<div class="language-js highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nx">A</span><span class="p">.</span><span class="nx">where</span><span class="p">().</span><span class="nx">findOneAndDelete</span><span class="p">()</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nx">A</span><span class="p">.</span><span class="nx">where</span><span class="p">().</span><span class="nx">findOneAndRemove</span><span class="p">()</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="nx">A</span><span class="p">.</span><span class="nx">where</span><span class="p">().</span><span class="nx">findOneAndRemove</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="nx">A</span><span class="p">.</span><span class="nx">where</span><span class="p">().</span><span class="nx">findOneAndRemove</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">)</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="c1">// the following all execute the command</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="k">await</span><span class="w"> </span><span class="nx">A</span><span class="p">.</span><span class="nx">where</span><span class="p">().</span><span class="nx">findOneAndRemove</span><span class="p">()</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="k">await</span><span class="w"> </span><span class="nx">A</span><span class="p">.</span><span class="nx">where</span><span class="p">().</span><span class="nx">findOneAndRemove</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="kd">const</span><span class="w"> </span><span class="nx">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">A</span><span class="p">.</span><span class="nx">where</span><span class="p">().</span><span class="nx">findOneAndRemove</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">);</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">  </span><span class="c1">// the document may not be found</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="distinct">distinct()</h3>
<p>Declares this query a <em>distinct</em> query. Optionally pass the distinct field, a match clause.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">distinct</span><span class="p">()</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">distinct</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">distinct</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span><span class="w"> </span><span class="nx">field</span><span class="p">)</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">distinct</span><span class="p">(</span><span class="nx">field</span><span class="p">)</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="c1">// the following all execute the command</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="k">await</span><span class="w"> </span><span class="nx">mquery</span><span class="p">().</span><span class="nx">distinct</span><span class="p">()</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="k">await</span><span class="w"> </span><span class="nx">mquery</span><span class="p">().</span><span class="nx">distinct</span><span class="p">(</span><span class="nx">field</span><span class="p">)</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="k">await</span><span class="w"> </span><span class="nx">mquery</span><span class="p">().</span><span class="nx">distinct</span><span class="p">(</span><span class="nx">match</span><span class="p">)</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">mquery</span><span class="p">().</span><span class="nx">distinct</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span><span class="w"> </span><span class="nx">field</span><span class="p">);</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="exec">exec()</h3>
<p>Executes the query.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">docs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">mquery</span><span class="p">().</span><span class="nx">findOne</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;route&#39;</span><span class="p">).</span><span class="nx">intersects</span><span class="p">(</span><span class="nx">polygon</span><span class="p">).</span><span class="nx">exec</span><span class="p">()</span>
</span></code></pre></div>
<h3 id="stream">stream()</h3>
<p>Executes the query and returns a stream.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mquery</span><span class="p">().</span><span class="nx">find</span><span class="p">().</span><span class="nx">stream</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">cb</span><span class="p">);</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">fn</span><span class="p">);</span>
</span></code></pre></div>
<p>Note: this only works with <code>find()</code> operations.</p>
<p>Note: returns the stream object directly from the node-mongodb-native driver. (currently streams1 type stream). Any options will be passed along to the <a href="http://mongodb.github.io/node-mongodb-native/api-generated/cursor.html#stream">driver method</a>.</p>
<hr />
<h3 id="all">all()</h3>
<p>Specifies an <code>$all</code> query condition</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;permission&#39;</span><span class="p">).</span><span class="nx">all</span><span class="p">([</span><span class="s1">&#39;read&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;write&#39;</span><span class="p">])</span>
</span></code></pre></div>
<p><a href="http://docs.mongodb.org/manual/reference/operator/all/">MongoDB documentation</a></p>
<h3 id="and">and()</h3>
<p>Specifies arguments for an <code>$and</code> condition</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">and</span><span class="p">([{</span><span class="w"> </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;green&#39;</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;ok&#39;</span><span class="w"> </span><span class="p">}])</span>
</span></code></pre></div>
<p><a href="http://docs.mongodb.org/manual/reference/operator/and/">MongoDB documentation</a></p>
<h3 id="box">box()</h3>
<p>Specifies a <code>$box</code> condition</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">lowerLeft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">40.73083</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">73.99756</span><span class="p">]</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">upperRight</span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">40.741404</span><span class="p">,</span><span class="w">  </span><span class="o">-</span><span class="mf">73.988135</span><span class="p">]</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="p">).</span><span class="nx">within</span><span class="p">().</span><span class="nx">box</span><span class="p">(</span><span class="nx">lowerLeft</span><span class="p">,</span><span class="w"> </span><span class="nx">upperRight</span><span class="p">)</span>
</span></code></pre></div>
<p><a href="http://docs.mongodb.org/manual/reference/operator/box/">MongoDB Documentation</a></p>
<h3 id="circle">circle()</h3>
<p>Specifies a <code>$center</code> or <code>$centerSphere</code> condition.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">center</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mf">50</span><span class="p">,</span><span class="w"> </span><span class="mf">50</span><span class="p">],</span><span class="w"> </span><span class="nx">radius</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="nx">unique</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="nx">query</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">).</span><span class="nx">within</span><span class="p">().</span><span class="nx">circle</span><span class="p">(</span><span class="nx">area</span><span class="p">)</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="nx">query</span><span class="p">.</span><span class="nx">circle</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">area</span><span class="p">);</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="c1">// for spherical calculations</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="kd">var</span><span class="w"> </span><span class="nx">area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">center</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mf">50</span><span class="p">,</span><span class="w"> </span><span class="mf">50</span><span class="p">],</span><span class="w"> </span><span class="nx">radius</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="nx">unique</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">spherical</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="nx">query</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">).</span><span class="nx">within</span><span class="p">().</span><span class="nx">circle</span><span class="p">(</span><span class="nx">area</span><span class="p">)</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="nx">query</span><span class="p">.</span><span class="nx">circle</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">area</span><span class="p">);</span>
</span></code></pre></div>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/operator/center/">MongoDB Documentation - center</a></li>
<li><a href="http://docs.mongodb.org/manual/reference/operator/centerSphere/">MongoDB Documentation - centerSphere</a></li>
</ul>
<h3 id="elemmatch">elemMatch()</h3>
<p>Specifies an <code>$elemMatch</code> condition</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="nx">query</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">).</span><span class="nx">elemMatch</span><span class="p">({</span><span class="w"> </span><span class="nx">author</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;autobot&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">votes</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">$gte</span><span class="o">:</span><span class="w"> </span><span class="mf">5</span><span class="p">}})</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="nx">query</span><span class="p">.</span><span class="nx">elemMatch</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">elem</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">  </span><span class="nx">elem</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">).</span><span class="nx">equals</span><span class="p">(</span><span class="s1">&#39;autobot&#39;</span><span class="p">);</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">  </span><span class="nx">elem</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">).</span><span class="nx">gte</span><span class="p">(</span><span class="mf">5</span><span class="p">);</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="p">})</span>
</span></code></pre></div>
<p><a href="http://docs.mongodb.org/manual/reference/operator/elemMatch/">MongoDB Documentation</a></p>
<h3 id="equals">equals()</h3>
<p>Specifies the complementary comparison value for the path specified with <code>where()</code>.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">).</span><span class="nx">equals</span><span class="p">(</span><span class="mf">49</span><span class="p">);</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="c1">// is the same as</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">({</span><span class="w"> </span><span class="s1">&#39;age&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">49</span><span class="w"> </span><span class="p">});</span>
</span></code></pre></div>
<h3 id="exists">exists()</h3>
<p>Specifies an <code>$exists</code> condition</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1">// { name: { $exists: true }}</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">()</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">exists</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="c1">// { name: { $exists: false }}</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">exists</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
</span></code></pre></div>
<p><a href="http://docs.mongodb.org/manual/reference/operator/exists/">MongoDB Documentation</a></p>
<h3 id="geometry">geometry()</h3>
<p>Specifies a <code>$geometry</code> condition</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">polyA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[[</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">20</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">40</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mf">30</span><span class="p">,</span><span class="w"> </span><span class="mf">40</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mf">30</span><span class="p">,</span><span class="w"> </span><span class="mf">20</span><span class="w"> </span><span class="p">]]]</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="nx">query</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">).</span><span class="nx">within</span><span class="p">().</span><span class="nx">geometry</span><span class="p">({</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Polygon&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">coordinates</span><span class="o">:</span><span class="w"> </span><span class="nx">polyA</span><span class="w"> </span><span class="p">})</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="c1">// or</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="kd">var</span><span class="w"> </span><span class="nx">polyB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">]]</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="nx">query</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">).</span><span class="nx">within</span><span class="p">().</span><span class="nx">geometry</span><span class="p">({</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;LineString&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">coordinates</span><span class="o">:</span><span class="w"> </span><span class="nx">polyB</span><span class="w"> </span><span class="p">})</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="c1">// or</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="kd">var</span><span class="w"> </span><span class="nx">polyC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">]</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="nx">query</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">).</span><span class="nx">within</span><span class="p">().</span><span class="nx">geometry</span><span class="p">({</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Point&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">coordinates</span><span class="o">:</span><span class="w"> </span><span class="nx">polyC</span><span class="w"> </span><span class="p">})</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="c1">// or</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="nx">query</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">).</span><span class="nx">intersects</span><span class="p">().</span><span class="nx">geometry</span><span class="p">({</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Point&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">coordinates</span><span class="o">:</span><span class="w"> </span><span class="nx">polyC</span><span class="w"> </span><span class="p">})</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="c1">// or</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="nx">query</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">).</span><span class="nx">near</span><span class="p">().</span><span class="nx">geometry</span><span class="p">({</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Point&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">coordinates</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mf">3</span><span class="p">,</span><span class="mf">5</span><span class="p">]</span><span class="w"> </span><span class="p">})</span>
</span></code></pre></div>
<p><code>geometry()</code> <strong>must</strong> come after <code>intersects()</code>, <code>within()</code>, or <code>near()</code>.</p>
<p>The <code>object</code> argument must contain <code>type</code> and <code>coordinates</code> properties.</p>
<ul>
<li>type <code>String</code></li>
<li>coordinates <code>Array</code></li>
</ul>
<p><a href="http://docs.mongodb.org/manual/reference/operator/geometry/">MongoDB Documentation</a></p>
<h3 id="gt">gt()</h3>
<p>Specifies a <code>$gt</code> query condition.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;clicks&#39;</span><span class="p">).</span><span class="nx">gt</span><span class="p">(</span><span class="mf">999</span><span class="p">)</span>
</span></code></pre></div>
<p><a href="http://docs.mongodb.org/manual/reference/operator/gt/">MongoDB Documentation</a></p>
<h3 id="gte">gte()</h3>
<p>Specifies a <code>$gte</code> query condition.</p>
<p><a href="http://docs.mongodb.org/manual/reference/operator/gte/">MongoDB Documentation</a></p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;clicks&#39;</span><span class="p">).</span><span class="nx">gte</span><span class="p">(</span><span class="mf">1000</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="in">in()</h3>
<p>Specifies an <code>$in</code> query condition.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;author_id&#39;</span><span class="p">).</span><span class="ow">in</span><span class="p">([</span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="mf">48901</span><span class="p">,</span><span class="w"> </span><span class="mf">761</span><span class="p">])</span>
</span></code></pre></div>
<p><a href="http://docs.mongodb.org/manual/reference/operator/in/">MongoDB Documentation</a></p>
<h3 id="intersects">intersects()</h3>
<p>Declares an <code>$geoIntersects</code> query for <code>geometry()</code>.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="nx">query</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">).</span><span class="nx">intersects</span><span class="p">().</span><span class="nx">geometry</span><span class="p">({</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="w">    </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;LineString&#39;</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="nx">coordinates</span><span class="o">:</span><span class="w"> </span><span class="p">[[</span><span class="mf">180.0</span><span class="p">,</span><span class="w"> </span><span class="mf">11.0</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mf">180</span><span class="p">,</span><span class="w"> </span><span class="mf">9.0</span><span class="p">]]</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="p">})</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="c1">// geometry arguments are supported</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="nx">query</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">).</span><span class="nx">intersects</span><span class="p">({</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w">    </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;LineString&#39;</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="nx">coordinates</span><span class="o">:</span><span class="w"> </span><span class="p">[[</span><span class="mf">180.0</span><span class="p">,</span><span class="w"> </span><span class="mf">11.0</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mf">180</span><span class="p">,</span><span class="w"> </span><span class="mf">9.0</span><span class="p">]]</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="p">})</span>
</span></code></pre></div>
<p><strong>Must</strong> be used after <code>where()</code>.</p>
<p><a href="http://docs.mongodb.org/manual/reference/operator/geoIntersects/">MongoDB Documentation</a></p>
<h3 id="lt">lt()</h3>
<p>Specifies a <code>$lt</code> query condition.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;clicks&#39;</span><span class="p">).</span><span class="nx">lt</span><span class="p">(</span><span class="mf">50</span><span class="p">)</span>
</span></code></pre></div>
<p><a href="http://docs.mongodb.org/manual/reference/operator/lt/">MongoDB Documentation</a></p>
<h3 id="lte">lte()</h3>
<p>Specifies a <code>$lte</code> query condition.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;clicks&#39;</span><span class="p">).</span><span class="nx">lte</span><span class="p">(</span><span class="mf">49</span><span class="p">)</span>
</span></code></pre></div>
<p><a href="http://docs.mongodb.org/manual/reference/operator/lte/">MongoDB Documentation</a></p>
<h3 id="maxdistance">maxDistance()</h3>
<p>Specifies a <code>$maxDistance</code> query condition.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="p">).</span><span class="nx">near</span><span class="p">({</span><span class="w"> </span><span class="nx">center</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mf">139</span><span class="p">,</span><span class="w"> </span><span class="mf">74.3</span><span class="p">]</span><span class="w"> </span><span class="p">}).</span><span class="nx">maxDistance</span><span class="p">(</span><span class="mf">5</span><span class="p">)</span>
</span></code></pre></div>
<p><a href="http://docs.mongodb.org/manual/reference/operator/maxDistance/">MongoDB Documentation</a></p>
<h3 id="mod">mod()</h3>
<p>Specifies a <code>$mod</code> condition</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">).</span><span class="nx">mod</span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span>
</span></code></pre></div>
<p><a href="http://docs.mongodb.org/manual/reference/operator/mod/">MongoDB Documentation</a></p>
<h3 id="ne">ne()</h3>
<p>Specifies a <code>$ne</code> query condition.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">).</span><span class="nx">ne</span><span class="p">(</span><span class="s1">&#39;ok&#39;</span><span class="p">)</span>
</span></code></pre></div>
<p><a href="http://docs.mongodb.org/manual/reference/operator/ne/">MongoDB Documentation</a></p>
<h3 id="nin">nin()</h3>
<p>Specifies an <code>$nin</code> query condition.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;author_id&#39;</span><span class="p">).</span><span class="nx">nin</span><span class="p">([</span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="mf">48901</span><span class="p">,</span><span class="w"> </span><span class="mf">761</span><span class="p">])</span>
</span></code></pre></div>
<p><a href="http://docs.mongodb.org/manual/reference/operator/nin/">MongoDB Documentation</a></p>
<h3 id="nor">nor()</h3>
<p>Specifies arguments for an <code>$nor</code> condition.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">nor</span><span class="p">([{</span><span class="w"> </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;green&#39;</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;ok&#39;</span><span class="w"> </span><span class="p">}])</span>
</span></code></pre></div>
<p><a href="http://docs.mongodb.org/manual/reference/operator/nor/">MongoDB Documentation</a></p>
<h3 id="near">near()</h3>
<p>Specifies arguments for a <code>$near</code> or <code>$nearSphere</code> condition.</p>
<p>These operators return documents sorted by distance.</p>
<h4 id="example">Example</h4>
<div class="language-js highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="nx">query</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">).</span><span class="nx">near</span><span class="p">({</span><span class="w"> </span><span class="nx">center</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">]</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="nx">query</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">).</span><span class="nx">near</span><span class="p">({</span><span class="w"> </span><span class="nx">center</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">],</span><span class="w"> </span><span class="nx">maxDistance</span><span class="o">:</span><span class="w"> </span><span class="mf">5</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="nx">query</span><span class="p">.</span><span class="nx">near</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">center</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">],</span><span class="w"> </span><span class="nx">maxDistance</span><span class="o">:</span><span class="w"> </span><span class="mf">5</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="c1">// GeoJSON</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="nx">query</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">).</span><span class="nx">near</span><span class="p">({</span><span class="w"> </span><span class="nx">center</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Point&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">coordinates</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">]</span><span class="w"> </span><span class="p">}});</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="nx">query</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">).</span><span class="nx">near</span><span class="p">({</span><span class="w"> </span><span class="nx">center</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Point&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">coordinates</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">]</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nx">maxDistance</span><span class="o">:</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="nx">spherical</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="nx">query</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">).</span><span class="nx">near</span><span class="p">().</span><span class="nx">geometry</span><span class="p">({</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Point&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">coordinates</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">]</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="c1">// For a $nearSphere condition, pass the `spherical` option.</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="nx">query</span><span class="p">.</span><span class="nx">near</span><span class="p">({</span><span class="w"> </span><span class="nx">center</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">],</span><span class="w"> </span><span class="nx">maxDistance</span><span class="o">:</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="nx">spherical</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">});</span>
</span></code></pre></div>
<p><a href="http://www.mongodb.org/display/DOCS/Geospatial+Indexing">MongoDB Documentation</a></p>
<h3 id="or">or()</h3>
<p>Specifies arguments for an <code>$or</code> condition.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">or</span><span class="p">([{</span><span class="w"> </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;red&#39;</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;emergency&#39;</span><span class="w"> </span><span class="p">}])</span>
</span></code></pre></div>
<p><a href="http://docs.mongodb.org/manual/reference/operator/or/">MongoDB Documentation</a></p>
<h3 id="polygon">polygon()</h3>
<p>Specifies a <code>$polygon</code> condition</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">).</span><span class="nx">within</span><span class="p">().</span><span class="nx">polygon</span><span class="p">([</span><span class="mf">10</span><span class="p">,</span><span class="mf">20</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mf">13</span><span class="p">,</span><span class="w"> </span><span class="mf">25</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mf">7</span><span class="p">,</span><span class="mf">15</span><span class="p">])</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">polygon</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mf">10</span><span class="p">,</span><span class="mf">20</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mf">13</span><span class="p">,</span><span class="w"> </span><span class="mf">25</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mf">7</span><span class="p">,</span><span class="mf">15</span><span class="p">])</span>
</span></code></pre></div>
<p><a href="http://docs.mongodb.org/manual/reference/operator/polygon/">MongoDB Documentation</a></p>
<h3 id="regex">regex()</h3>
<p>Specifies a <code>$regex</code> query condition.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">).</span><span class="nx">regex</span><span class="p">(</span><span class="sr">/^sixstepsrecords/</span><span class="p">)</span>
</span></code></pre></div>
<p><a href="http://docs.mongodb.org/manual/reference/operator/regex/">MongoDB Documentation</a></p>
<h3 id="select">select()</h3>
<p>Specifies which document fields to include or exclude</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1">// 1 means include, 0 means exclude</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">select</span><span class="p">({</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">address</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">})</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="c1">// or</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;name address -_id&#39;</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="string-syntax">String syntax</h4>
<p>When passing a string, prefixing a path with <code>-</code> will flag that path as excluded. When a path does not have the <code>-</code> prefix, it is included.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="c1">// include a and b, exclude c</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="nx">query</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;a b -c&#39;</span><span class="p">);</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="c1">// or you may use object notation, useful when</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="c1">// you have keys already prefixed with a &quot;-&quot;</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="nx">query</span><span class="p">.</span><span class="nx">select</span><span class="p">({</span><span class="nx">a</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">});</span>
</span></code></pre></div>
<p><em>Cannot be used with <code>distinct()</code>.</em></p>
<h3 id="selected">selected()</h3>
<p>Determines if the query has selected any fields.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mquery</span><span class="p">();</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="nx">query</span><span class="p">.</span><span class="nx">selected</span><span class="p">()</span><span class="w"> </span><span class="c1">// false</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="nx">query</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;-name&#39;</span><span class="p">);</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="nx">query</span><span class="p">.</span><span class="nx">selected</span><span class="p">()</span><span class="w"> </span><span class="c1">// true</span>
</span></code></pre></div>
<h3 id="selectedinclusively">selectedInclusively()</h3>
<p>Determines if the query has selected any fields inclusively.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mquery</span><span class="p">().</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="nx">query</span><span class="p">.</span><span class="nx">selectedInclusively</span><span class="p">()</span><span class="w"> </span><span class="c1">// true</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="kd">var</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mquery</span><span class="p">();</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="nx">query</span><span class="p">.</span><span class="nx">selected</span><span class="p">()</span><span class="w"> </span><span class="c1">// false</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="nx">query</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;-name&#39;</span><span class="p">);</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="nx">query</span><span class="p">.</span><span class="nx">selectedInclusively</span><span class="p">()</span><span class="w"> </span><span class="c1">// false</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="nx">query</span><span class="p">.</span><span class="nx">selectedExclusively</span><span class="p">()</span><span class="w"> </span><span class="c1">// true</span>
</span></code></pre></div>
<h3 id="selectedexclusively">selectedExclusively()</h3>
<p>Determines if the query has selected any fields exclusively.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mquery</span><span class="p">().</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;-name&#39;</span><span class="p">);</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="nx">query</span><span class="p">.</span><span class="nx">selectedExclusively</span><span class="p">()</span><span class="w"> </span><span class="c1">// true</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="kd">var</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mquery</span><span class="p">();</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="nx">query</span><span class="p">.</span><span class="nx">selected</span><span class="p">()</span><span class="w"> </span><span class="c1">// false</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="nx">query</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="nx">query</span><span class="p">.</span><span class="nx">selectedExclusively</span><span class="p">()</span><span class="w"> </span><span class="c1">// false</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="nx">query</span><span class="p">.</span><span class="nx">selectedInclusively</span><span class="p">()</span><span class="w"> </span><span class="c1">// true</span>
</span></code></pre></div>
<h3 id="size">size()</h3>
<p>Specifies a <code>$size</code> query condition.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;someArray&#39;</span><span class="p">).</span><span class="nx">size</span><span class="p">(</span><span class="mf">6</span><span class="p">)</span>
</span></code></pre></div>
<p><a href="http://docs.mongodb.org/manual/reference/operator/size/">MongoDB Documentation</a></p>
<h3 id="slice">slice()</h3>
<p>Specifies a <code>$slice</code> projection for a <code>path</code></p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mf">5</span><span class="p">)</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mf">5</span><span class="p">)</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">).</span><span class="nx">slice</span><span class="p">([</span><span class="o">-</span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">])</span>
</span></code></pre></div>
<p><a href="http://docs.mongodb.org/manual/reference/projection/slice/">MongoDB Documentation</a></p>
<h3 id="within">within()</h3>
<p>Sets a <code>$geoWithin</code> or <code>$within</code> argument for geo-spatial queries.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">within</span><span class="p">().</span><span class="nx">box</span><span class="p">()</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">within</span><span class="p">().</span><span class="nx">circle</span><span class="p">()</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">within</span><span class="p">().</span><span class="nx">geometry</span><span class="p">()</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">).</span><span class="nx">within</span><span class="p">({</span><span class="w"> </span><span class="nx">center</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mf">50</span><span class="p">,</span><span class="mf">50</span><span class="p">],</span><span class="w"> </span><span class="nx">radius</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="nx">unique</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">spherical</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">).</span><span class="nx">within</span><span class="p">({</span><span class="w"> </span><span class="nx">box</span><span class="o">:</span><span class="w"> </span><span class="p">[[</span><span class="mf">40.73</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">73.9</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mf">40.7</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">73.988</span><span class="p">]]</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">).</span><span class="nx">within</span><span class="p">({</span><span class="w"> </span><span class="nx">polygon</span><span class="o">:</span><span class="w"> </span><span class="p">[[],[],[],[]]</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">).</span><span class="nx">within</span><span class="p">([],</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="p">[])</span><span class="w"> </span><span class="c1">// polygon</span>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">).</span><span class="nx">within</span><span class="p">([],</span><span class="w"> </span><span class="p">[])</span><span class="w"> </span><span class="c1">// box</span>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">).</span><span class="nx">within</span><span class="p">({</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;LineString&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">coordinates</span><span class="o">:</span><span class="w"> </span><span class="p">[...]</span><span class="w"> </span><span class="p">});</span><span class="w"> </span><span class="c1">// geometry</span>
</span></code></pre></div>
<p>As of mquery 2.0, <code>$geoWithin</code> is used by default. This impacts you if running MongoDB &lt; 2.4. To alter this behavior, see <a href="#mqueryusegeowithin">mquery.use$geoWithin</a>.</p>
<p><strong>Must</strong> be used after <code>where()</code>.</p>
<p><a href="http://docs.mongodb.org/manual/reference/operator/geoWithin/">MongoDB Documentation</a></p>
<h3 id="where">where()</h3>
<p>Specifies a <code>path</code> for use with chaining</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1">// instead of writing:</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">find</span><span class="p">({</span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">$gte</span><span class="o">:</span><span class="w"> </span><span class="mf">21</span><span class="p">,</span><span class="w"> </span><span class="nx">$lte</span><span class="o">:</span><span class="w"> </span><span class="mf">65</span><span class="p">}});</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="c1">// we can instead write:</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">).</span><span class="nx">gte</span><span class="p">(</span><span class="mf">21</span><span class="p">).</span><span class="nx">lte</span><span class="p">(</span><span class="mf">65</span><span class="p">);</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="c1">// passing query conditions is permitted too</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">find</span><span class="p">().</span><span class="nx">where</span><span class="p">({</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;vonderful&#39;</span><span class="w"> </span><span class="p">})</span>
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="c1">// chaining</span>
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a><span class="k">await</span><span class="w"> </span><span class="nx">mquery</span><span class="p">()</span>
</span><span id="__span-40-12"><a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a><span class="w">  </span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">).</span><span class="nx">gte</span><span class="p">(</span><span class="mf">21</span><span class="p">).</span><span class="nx">lte</span><span class="p">(</span><span class="mf">65</span><span class="p">)</span>
</span><span id="__span-40-13"><a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a><span class="w">  </span><span class="p">.</span><span class="nx">where</span><span class="p">({</span><span class="w"> </span><span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="w"> </span><span class="sr">/^vonderful/i</span><span class="w"> </span><span class="p">})</span>
</span><span id="__span-40-14"><a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a><span class="w">  </span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;friends&#39;</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mf">10</span><span class="p">)</span>
</span><span id="__span-40-15"><a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a><span class="w">  </span><span class="p">.</span><span class="nx">exec</span><span class="p">()</span>
</span></code></pre></div>
<h3 id="where_1">$where()</h3>
<p>Specifies a <code>$where</code> condition.</p>
<p>Use <code>$where</code> when you need to select documents using a JavaScript expression.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="k">await</span><span class="w"> </span><span class="nx">query</span><span class="p">.</span><span class="nx">$where</span><span class="p">(</span><span class="s1">&#39;this.comments.length &gt; 10 || this.name.length &gt; 5&#39;</span><span class="p">).</span><span class="nx">exec</span><span class="p">()</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="nx">query</span><span class="p">.</span><span class="nx">$where</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">comments</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">10</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">5</span><span class="p">;</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="p">})</span>
</span></code></pre></div>
<p>Only use <code>$where</code> when you have a condition that cannot be met using other MongoDB operators like <code>$lt</code>. Be sure to read about all of <a href="http://docs.mongodb.org/manual/reference/operator/where/">its caveats</a> before using.</p>
<hr />
<h3 id="batchsize">batchSize()</h3>
<p>Specifies the batchSize option.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="nx">query</span><span class="p">.</span><span class="nx">batchSize</span><span class="p">(</span><span class="mf">100</span><span class="p">)</span>
</span></code></pre></div>
<p><em>Cannot be used with <code>distinct()</code>.</em></p>
<p><a href="http://docs.mongodb.org/manual/reference/method/cursor.batchSize/">MongoDB documentation</a></p>
<h3 id="collation">collation()</h3>
<p>Specifies the collation option.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="nx">query</span><span class="p">.</span><span class="nx">collation</span><span class="p">({</span><span class="w"> </span><span class="nx">locale</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;en_US&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">strength</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">})</span>
</span></code></pre></div>
<p><a href="https://docs.mongodb.com/manual/reference/method/cursor.collation/#cursor.collation">MongoDB documentation</a></p>
<h3 id="comment">comment()</h3>
<p>Specifies the comment option.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="nx">query</span><span class="p">.</span><span class="nx">comment</span><span class="p">(</span><span class="s1">&#39;login query&#39;</span><span class="p">);</span>
</span></code></pre></div>
<p><em>Cannot be used with <code>distinct()</code>.</em></p>
<p><a href="http://docs.mongodb.org/manual/reference/operator/">MongoDB documentation</a></p>
<h3 id="hint">hint()</h3>
<p>Sets query hints.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">hint</span><span class="p">({</span><span class="w"> </span><span class="nx">indexA</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">indexB</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="w"> </span><span class="p">})</span>
</span></code></pre></div>
<p><em>Cannot be used with <code>distinct()</code>.</em></p>
<p><a href="http://docs.mongodb.org/manual/reference/operator/hint/">MongoDB documentation</a></p>
<h3 id="j">j()</h3>
<p>Requests acknowledgement that this operation has been persisted to MongoDB's on-disk journal.</p>
<p>This option is only valid for operations that write to the database:</p>
<ul>
<li><code>deleteOne()</code></li>
<li><code>deleteMany()</code></li>
<li><code>findOneAndDelete()</code></li>
<li><code>findOneAndUpdate()</code></li>
<li><code>updateOne()</code></li>
<li><code>updateMany()</code></li>
</ul>
<p>Defaults to the <code>j</code> value if it is specified in <a href="#writeconcern">writeConcern</a></p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">j</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="limit">limit()</h3>
<p>Specifies the limit option.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="nx">query</span><span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mf">20</span><span class="p">)</span>
</span></code></pre></div>
<p><em>Cannot be used with <code>distinct()</code>.</em></p>
<p><a href="http://docs.mongodb.org/manual/reference/method/cursor.limit/">MongoDB documentation</a></p>
<h3 id="maxtime">maxTime()</h3>
<p>Specifies the maxTimeMS option.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="nx">query</span><span class="p">.</span><span class="nx">maxTime</span><span class="p">(</span><span class="mf">100</span><span class="p">)</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="nx">query</span><span class="p">.</span><span class="nx">maxTimeMS</span><span class="p">(</span><span class="mf">100</span><span class="p">)</span>
</span></code></pre></div>
<p><a href="http://docs.mongodb.org/manual/reference/method/cursor.maxTimeMS/">MongoDB documentation</a></p>
<h3 id="skip">skip()</h3>
<p>Specifies the skip option.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="nx">query</span><span class="p">.</span><span class="nx">skip</span><span class="p">(</span><span class="mf">100</span><span class="p">).</span><span class="nx">limit</span><span class="p">(</span><span class="mf">20</span><span class="p">)</span>
</span></code></pre></div>
<p><em>Cannot be used with <code>distinct()</code>.</em></p>
<p><a href="http://docs.mongodb.org/manual/reference/method/cursor.skip/">MongoDB documentation</a></p>
<h3 id="sort">sort()</h3>
<p>Sets the query sort order.</p>
<p>If an object is passed, key values allowed are <code>asc</code>, <code>desc</code>, <code>ascending</code>, <code>descending</code>, <code>1</code>, and <code>-1</code>.</p>
<p>If a string is passed, it must be a space delimited list of path names. The sort order of each path is ascending unless the path name is prefixed with <code>-</code> which will be treated as descending.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="c1">// these are equivalent</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="nx">query</span><span class="p">.</span><span class="nx">sort</span><span class="p">({</span><span class="w"> </span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;asc&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">test</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="nx">query</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="s1">&#39;field -test&#39;</span><span class="p">);</span>
</span></code></pre></div>
<p><em>Cannot be used with <code>distinct()</code>.</em></p>
<p><a href="http://docs.mongodb.org/manual/reference/method/cursor.sort/">MongoDB documentation</a></p>
<h3 id="read">read()</h3>
<p>Sets the readPreference option for the query.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">read</span><span class="p">(</span><span class="s1">&#39;primary&#39;</span><span class="p">)</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">read</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span><span class="w">  </span><span class="c1">// same as primary</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">read</span><span class="p">(</span><span class="s1">&#39;primaryPreferred&#39;</span><span class="p">)</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">read</span><span class="p">(</span><span class="s1">&#39;pp&#39;</span><span class="p">)</span><span class="w"> </span><span class="c1">// same as primaryPreferred</span>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">read</span><span class="p">(</span><span class="s1">&#39;secondary&#39;</span><span class="p">)</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">read</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span><span class="w">  </span><span class="c1">// same as secondary</span>
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a>
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">read</span><span class="p">(</span><span class="s1">&#39;secondaryPreferred&#39;</span><span class="p">)</span>
</span><span id="__span-51-11"><a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">read</span><span class="p">(</span><span class="s1">&#39;sp&#39;</span><span class="p">)</span><span class="w"> </span><span class="c1">// same as secondaryPreferred</span>
</span><span id="__span-51-12"><a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a>
</span><span id="__span-51-13"><a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">read</span><span class="p">(</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
</span><span id="__span-51-14"><a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">read</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)</span><span class="w">  </span><span class="c1">// same as nearest</span>
</span><span id="__span-51-15"><a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a>
</span><span id="__span-51-16"><a id="__codelineno-51-16" name="__codelineno-51-16" href="#__codelineno-51-16"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">setReadPreference</span><span class="p">(</span><span class="s1">&#39;primary&#39;</span><span class="p">)</span><span class="w"> </span><span class="c1">// alias of .read()</span>
</span></code></pre></div>
<h4 id="preferences">Preferences:</h4>
<ul>
<li><code>primary</code> - (default) Read from primary only. Operations will produce an error if primary is unavailable. Cannot be combined with tags.</li>
<li><code>secondary</code> - Read from secondary if available, otherwise error.</li>
<li><code>primaryPreferred</code> - Read from primary if available, otherwise a secondary.</li>
<li><code>secondaryPreferred</code> - Read from a secondary if available, otherwise read from the primary.</li>
<li><code>nearest</code> - All operations read from among the nearest candidates, but unlike other modes, this option will include both the primary and all secondaries in the random selection.</li>
</ul>
<p>Aliases</p>
<ul>
<li><code>p</code>   primary</li>
<li><code>pp</code>  primaryPreferred</li>
<li><code>s</code>   secondary</li>
<li><code>sp</code>  secondaryPreferred</li>
<li><code>n</code>   nearest</li>
</ul>
<h4 id="preference-tags">Preference Tags:</h4>
<p>To keep the separation of concerns between <code>mquery</code> and your driver
clean, <code>mquery#read()</code> no longer handles specifying a second <code>tags</code> argument as of version 0.5.
If you need to specify tags, pass any non-string argument as the first argument.
<code>mquery</code> will pass this argument untouched to your collections methods later.
For example:</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="c1">// example of specifying tags using the Node.js driver</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">ReadPref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongodb&#39;</span><span class="p">).</span><span class="nx">ReadPreference</span><span class="p">;</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="kd">var</span><span class="w"> </span><span class="nx">preference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">ReadPref</span><span class="p">(</span><span class="s1">&#39;secondary&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[{</span><span class="w"> </span><span class="nx">dc</span><span class="o">:</span><span class="s1">&#39;sf&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">},{</span><span class="w"> </span><span class="nx">dc</span><span class="o">:</span><span class="s1">&#39;ma&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="p">}]);</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="nx">mquery</span><span class="p">(...).</span><span class="nx">read</span><span class="p">(</span><span class="nx">preference</span><span class="p">).</span><span class="nx">exec</span><span class="p">();</span>
</span></code></pre></div>
<p>Read more about how to use read preferences <a href="http://docs.mongodb.org/manual/applications/replication/#read-preference">here</a> and <a href="http://mongodb.github.com/node-mongodb-native/driver-articles/anintroductionto1_1and2_2.html#read-preferences">here</a>.</p>
<h3 id="readconcern">readConcern()</h3>
<p>Sets the readConcern option for the query.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="c1">// local</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">readConcern</span><span class="p">(</span><span class="s1">&#39;local&#39;</span><span class="p">)</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">readConcern</span><span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">)</span>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">r</span><span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">)</span>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a><span class="c1">// available</span>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">readConcern</span><span class="p">(</span><span class="s1">&#39;available&#39;</span><span class="p">)</span>
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">readConcern</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">r</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
</span><span id="__span-53-10"><a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a>
</span><span id="__span-53-11"><a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a><span class="c1">// majority</span>
</span><span id="__span-53-12"><a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">readConcern</span><span class="p">(</span><span class="s1">&#39;majority&#39;</span><span class="p">)</span>
</span><span id="__span-53-13"><a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">readConcern</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
</span><span id="__span-53-14"><a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">r</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
</span><span id="__span-53-15"><a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a>
</span><span id="__span-53-16"><a id="__codelineno-53-16" name="__codelineno-53-16" href="#__codelineno-53-16"></a><span class="c1">// linearizable</span>
</span><span id="__span-53-17"><a id="__codelineno-53-17" name="__codelineno-53-17" href="#__codelineno-53-17"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">readConcern</span><span class="p">(</span><span class="s1">&#39;linearizable&#39;</span><span class="p">)</span>
</span><span id="__span-53-18"><a id="__codelineno-53-18" name="__codelineno-53-18" href="#__codelineno-53-18"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">readConcern</span><span class="p">(</span><span class="s1">&#39;lz&#39;</span><span class="p">)</span>
</span><span id="__span-53-19"><a id="__codelineno-53-19" name="__codelineno-53-19" href="#__codelineno-53-19"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">r</span><span class="p">(</span><span class="s1">&#39;lz&#39;</span><span class="p">)</span>
</span><span id="__span-53-20"><a id="__codelineno-53-20" name="__codelineno-53-20" href="#__codelineno-53-20"></a>
</span><span id="__span-53-21"><a id="__codelineno-53-21" name="__codelineno-53-21" href="#__codelineno-53-21"></a><span class="c1">// snapshot</span>
</span><span id="__span-53-22"><a id="__codelineno-53-22" name="__codelineno-53-22" href="#__codelineno-53-22"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">readConcern</span><span class="p">(</span><span class="s1">&#39;snapshot&#39;</span><span class="p">)</span>
</span><span id="__span-53-23"><a id="__codelineno-53-23" name="__codelineno-53-23" href="#__codelineno-53-23"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">readConcern</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
</span><span id="__span-53-24"><a id="__codelineno-53-24" name="__codelineno-53-24" href="#__codelineno-53-24"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">r</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="read-concern-level">Read Concern Level:</h4>
<ul>
<li><code>local</code> - The query returns from the instance with no guarantee guarantee that the data has been written to a majority of the replica set members (i.e. may be rolled back). (MongoDB 3.2+)</li>
<li><code>available</code> - The query returns from the instance with no guarantee guarantee that the data has been written to a majority of the replica set members (i.e. may be rolled back). (MongoDB 3.6+)</li>
<li><code>majority</code> - The query returns the data that has been acknowledged by a majority of the replica set members. The documents returned by the read operation are durable, even in the event of failure. (MongoDB 3.2+)</li>
<li><code>linearizable</code> - The query returns data that reflects all successful majority-acknowledged writes that completed prior to the start of the read operation. The query may wait for concurrently executing writes to propagate to a majority of replica set members before returning results. (MongoDB 3.4+)</li>
<li><code>snapshot</code> - Only available for operations within multi-document transactions. Upon transaction commit with write concern "majority", the transaction operations are guaranteed to have read from a snapshot of majority-committed data. (MongoDB 4.0+)</li>
</ul>
<p>Aliases</p>
<ul>
<li><code>l</code>   local</li>
<li><code>a</code>   available</li>
<li><code>m</code>   majority</li>
<li><code>lz</code>  linearizable</li>
<li><code>s</code>   snapshot</li>
</ul>
<p>Read more about how to use read concern <a href="https://docs.mongodb.com/manual/reference/read-concern/">here</a>.</p>
<h3 id="writeconcern">writeConcern()</h3>
<p>Sets the writeConcern option for the query.</p>
<p>This option is only valid for operations that write to the database:</p>
<ul>
<li><code>deleteOne()</code></li>
<li><code>deleteMany()</code></li>
<li><code>findOneAndDelete()</code></li>
<li><code>findOneAndUpdate()</code></li>
<li><code>updateOne()</code></li>
<li><code>updateMany()</code></li>
</ul>
<div class="language-js highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">writeConcern</span><span class="p">(</span><span class="mf">0</span><span class="p">)</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">writeConcern</span><span class="p">(</span><span class="mf">1</span><span class="p">)</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">writeConcern</span><span class="p">({</span><span class="w"> </span><span class="nx">w</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">j</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">wtimeout</span><span class="o">:</span><span class="w"> </span><span class="mf">2000</span><span class="w"> </span><span class="p">})</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">writeConcern</span><span class="p">(</span><span class="s1">&#39;majority&#39;</span><span class="p">)</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">writeConcern</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span><span class="w"> </span><span class="c1">// same as majority</span>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">writeConcern</span><span class="p">(</span><span class="s1">&#39;tagSetName&#39;</span><span class="p">)</span><span class="w"> </span><span class="c1">// if the tag set is &#39;m&#39;, use .writeConcern({ w: &#39;m&#39; }) instead</span>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">w</span><span class="p">(</span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="c1">// w is alias of writeConcern</span>
</span></code></pre></div>
<h4 id="write-concern">Write Concern:</h4>
<p>writeConcern({ w: <code>&lt;value&gt;</code>, j: <code>&lt;boolean&gt;</code>, wtimeout: <code>&lt;number&gt;</code> }`)</p>
<ul>
<li>the w option to request acknowledgement that the write operation has propagated to a specified number of mongod instances or to mongod instances with specified tags</li>
<li>the j option to request acknowledgement that the write operation has been written to the journal</li>
<li>the wtimeout option to specify a time limit to prevent write operations from blocking indefinitely</li>
</ul>
<p>Can be break down to use the following syntax:</p>
<p>mquery().w(<code>&lt;value&gt;</code>).j(<code>&lt;boolean&gt;</code>).wtimeout(<code>&lt;number&gt;</code>)</p>
<p>Read more about how to use write concern <a href="https://docs.mongodb.com/manual/reference/write-concern/">here</a></p>
<h3 id="slaveok">slaveOk()</h3>
<p>Sets the slaveOk option. <code>true</code> allows reading from secondaries.</p>
<p><strong>deprecated</strong> use <a href="#read">read()</a> preferences instead if on mongodb &gt;= 2.2</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="nx">query</span><span class="p">.</span><span class="nx">slaveOk</span><span class="p">()</span><span class="w"> </span><span class="c1">// true</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="nx">query</span><span class="p">.</span><span class="nx">slaveOk</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="nx">query</span><span class="p">.</span><span class="nx">slaveOk</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
</span></code></pre></div>
<p><a href="http://docs.mongodb.org/manual/reference/method/rs.slaveOk/">MongoDB documentation</a></p>
<h3 id="tailable">tailable()</h3>
<p>Sets tailable option.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">tailable</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;==</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">tailable</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">tailable</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
</span></code></pre></div>
<p><em>Cannot be used with <code>distinct()</code>.</em></p>
<p><a href="http://docs.mongodb.org/manual/tutorial/create-tailable-cursor/">MongoDB Documentation</a></p>
<h3 id="wtimeout">wtimeout()</h3>
<p>Specifies a time limit, in milliseconds, for the write concern. If <code>w &gt; 1</code>, it is maximum amount of time to
wait for this write to propagate through the replica set before this operation fails. The default is <code>0</code>, which means no timeout.</p>
<p>This option is only valid for operations that write to the database:</p>
<ul>
<li><code>deleteOne()</code></li>
<li><code>deleteMany()</code></li>
<li><code>findOneAndDelete()</code></li>
<li><code>findOneAndUpdate()</code></li>
<li><code>updateOne()</code></li>
<li><code>updateMany()</code></li>
</ul>
<p>Defaults to <code>wtimeout</code> value if it is specified in <a href="#writeconcern">writeConcern</a></p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">wtimeout</span><span class="p">(</span><span class="mf">2000</span><span class="p">)</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">wTimeout</span><span class="p">(</span><span class="mf">2000</span><span class="p">)</span>
</span></code></pre></div>
<h2 id="helpers_1">Helpers</h2>
<h3 id="collection">collection()</h3>
<p>Sets the querys collection.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">collection</span><span class="p">(</span><span class="nx">aCollection</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="then">then()</h3>
<p>Executes the query and returns a promise which will be resolved with the query results or rejected if the query responds with an error.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">find</span><span class="p">(..).</span><span class="nx">then</span><span class="p">(</span><span class="nx">success</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span></code></pre></div>
<p>This is very useful when combined with <a href="https://github.com/visionmedia/co">co</a> or <a href="https://github.com/koajs/koa">koa</a>, which automatically resolve promise-like objects for you.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="nx">co</span><span class="p">(</span><span class="kd">function</span><span class="o">*</span><span class="p">(){</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">yield</span><span class="w"> </span><span class="nx">mquery</span><span class="p">().</span><span class="nx">findOne</span><span class="p">({</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="mf">499</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span><span class="w"> </span><span class="c1">// { _id: 499, name: &#39;amazing&#39;, .. }</span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="p">})();</span>
</span></code></pre></div>
<p><em>NOTE</em>:
The returned promise is a <a href="https://github.com/petkaantonov/bluebird/">bluebird</a> promise but this is customizable. If you want to
use your favorite promise library, simply set <code>mquery.Promise = YourPromiseConstructor</code>.
Your <code>Promise</code> must be <a href="http://promisesaplus.com/">promises A+</a> compliant.</p>
<h3 id="mergeobject">merge(object)</h3>
<p>Merges other mquery or match condition objects into this one. When an mquery instance is passed, its match conditions, field selection and options are merged.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">drum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mquery</span><span class="p">({</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;drum&#39;</span><span class="w"> </span><span class="p">}).</span><span class="nx">collection</span><span class="p">(</span><span class="nx">instruments</span><span class="p">);</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">redDrum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mquery</span><span class="p">({</span><span class="w"> </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;red&#39;</span><span class="w"> </span><span class="p">}).</span><span class="nx">merge</span><span class="p">(</span><span class="nx">drum</span><span class="p">);</span>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">redDrum</span><span class="p">.</span><span class="nx">count</span><span class="p">();</span>
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;there are %d red drums&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">n</span><span class="p">);</span>
</span></code></pre></div>
<p>Internally uses <code>mquery.canMerge</code> to determine validity.</p>
<h3 id="setoptionsoptions">setOptions(options)</h3>
<p>Sets query options.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">setOptions</span><span class="p">({</span><span class="w"> </span><span class="nx">collection</span><span class="o">:</span><span class="w"> </span><span class="nx">coll</span><span class="p">,</span><span class="w"> </span><span class="nx">limit</span><span class="o">:</span><span class="w"> </span><span class="mf">20</span><span class="w"> </span><span class="p">})</span>
</span></code></pre></div>
<h4 id="setoptions-options">setOptions() options</h4>
<ul>
<li><a href="#tailable">tailable</a> *</li>
<li><a href="#sort">sort</a> *</li>
<li><a href="#limit">limit</a> *</li>
<li><a href="#skip">skip</a> *</li>
<li><a href="#maxtime">maxTime</a> *</li>
<li><a href="#batchsize">batchSize</a> *</li>
<li><a href="#comment">comment</a> *</li>
<li><a href="#hint">hint</a> *</li>
<li><a href="#collection">collection</a>: the collection to query against</li>
</ul>
<p><em>* denotes a query helper method is also available</em></p>
<h3 id="settracefunctionfunc">setTraceFunction(func)</h3>
<p>Set a function to trace this query. Useful for profiling or logging.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">traceFunction</span><span class="w"> </span><span class="p">(</span><span class="nx">method</span><span class="p">,</span><span class="w"> </span><span class="nx">queryInfo</span><span class="p">,</span><span class="w"> </span><span class="nx">query</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;starting &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">method</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; query&#39;</span><span class="p">);</span>
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">millis</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;finished &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">method</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; query in &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">millis</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;ms&#39;</span><span class="p">);</span>
</span><span id="__span-63-6"><a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-63-7"><a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a><span class="p">}</span>
</span><span id="__span-63-8"><a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a>
</span><span id="__span-63-9"><a id="__codelineno-63-9" name="__codelineno-63-9" href="#__codelineno-63-9"></a><span class="nx">mquery</span><span class="p">().</span><span class="nx">setTraceFunction</span><span class="p">(</span><span class="nx">traceFunction</span><span class="p">).</span><span class="nx">findOne</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Joe&#39;</span><span class="p">},</span><span class="w"> </span><span class="nx">cb</span><span class="p">);</span>
</span></code></pre></div>
<p>The trace function is passed (method, queryInfo, query)</p>
<ul>
<li>method is the name of the method being called (e.g. findOne)</li>
<li>queryInfo contains information about the query:</li>
<li>conditions: query conditions/criteria</li>
<li>options: options such as sort, fields, etc</li>
<li>doc: document being updated</li>
<li>query is the query object</li>
</ul>
<p>The trace function should return a callback function which accepts:
- err: error, if any
- result: result, if any
- millis: time spent waiting for query result</p>
<p>NOTE: stream requests are not traced.</p>
<h3 id="mquerysetglobaltracefunctionfunc">mquery.setGlobalTraceFunction(func)</h3>
<p>Similar to <code>setTraceFunction()</code> but automatically applied to all queries.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="nx">mquery</span><span class="p">.</span><span class="nx">setTraceFunction</span><span class="p">(</span><span class="nx">traceFunction</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="mquerycanmergeconditions">mquery.canMerge(conditions)</h3>
<p>Determines if <code>conditions</code> can be merged using <code>mquery().merge()</code>.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mquery</span><span class="p">({</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;drum&#39;</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">okToMerge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mquery</span><span class="p">.</span><span class="nx">canMerge</span><span class="p">(</span><span class="nx">anObject</span><span class="p">)</span>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">okToMerge</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="w">  </span><span class="nx">query</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">anObject</span><span class="p">);</span>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="mqueryusegeowithin">mquery.use$geoWithin</h2>
<p>MongoDB 2.4 introduced the <code>$geoWithin</code> operator which replaces and is 100% backward compatible with <code>$within</code>. As of mquery 0.2, we default to using <code>$geoWithin</code> for all <code>within()</code> calls.</p>
<p>If you are running MongoDB &lt; 2.4 this will be problematic. To force <code>mquery</code> to be backward compatible and always use <code>$within</code>, set the <code>mquery.use$geoWithin</code> flag to <code>false</code>.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="nx">mquery</span><span class="p">.</span><span class="nx">use$geoWithin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span></code></pre></div>
<h2 id="custom-base-queries">Custom Base Queries</h2>
<p>Often times we want custom base queries that encapsulate predefined criteria. With <code>mquery</code> this is easy. First create the query you want to reuse and call its <code>toConstructor()</code> method which returns a new subclass of <code>mquery</code> that retains all options and criteria of the original.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">greatMovies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mquery</span><span class="p">(</span><span class="nx">movieCollection</span><span class="p">).</span><span class="nx">where</span><span class="p">(</span><span class="s1">&#39;rating&#39;</span><span class="p">).</span><span class="nx">gte</span><span class="p">(</span><span class="mf">4.5</span><span class="p">).</span><span class="nx">toConstructor</span><span class="p">();</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="c1">// use it!</span>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">greatMovies</span><span class="p">().</span><span class="nx">count</span><span class="p">();</span>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;There are %d great movies&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">n</span><span class="p">);</span>
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a>
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a><span class="kd">const</span><span class="w"> </span><span class="nx">docs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">greatMovies</span><span class="p">().</span><span class="nx">where</span><span class="p">({</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sr">/^Life/</span><span class="w"> </span><span class="p">}).</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">();</span>
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">docs</span><span class="p">);</span>
</span></code></pre></div>
<h2 id="validation">Validation</h2>
<p>Method and options combinations are checked for validity at runtime to prevent creation of invalid query constructs. For example, a <code>distinct</code> query does not support specifying options like <code>hint</code> or field selection. In this case an error will be thrown so you can catch these mistakes in development.</p>
<h2 id="debug-support">Debug support</h2>
<p>Debug mode is provided through the use of the <a href="https://github.com/visionmedia/debug">debug</a> module. To enable:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="nv">DEBUG</span><span class="o">=</span>mquery<span class="w"> </span>node<span class="w"> </span>yourprogram.js
</span></code></pre></div>
<p>Read the debug module documentation for more details.</p>
<h2 id="general-compatibility">General compatibility</h2>
<h3 id="objectids">ObjectIds</h3>
<p><code>mquery</code> clones query arguments before passing them to a <code>collection</code> method for execution.
This prevents accidental side-affects to the objects you pass.
To clone <code>ObjectIds</code> we need to make some assumptions.</p>
<p>First, to check if an object is an <code>ObjectId</code>, we check its constructors name. If it matches either
<code>ObjectId</code> or <code>ObjectID</code> we clone it.</p>
<p>To clone <code>ObjectIds</code>, we call its optional <code>clone</code> method. If a <code>clone</code> method does not exist, we fall
back to calling <code>new obj.constructor(obj.id)</code>. We assume, for compatibility with the
Node.js driver, that the <code>ObjectId</code> instance has a public <code>id</code> property and that
when creating an <code>ObjectId</code> instance we can pass that <code>id</code> as an argument.</p>
<h4 id="read-preferences">Read Preferences</h4>
<p><code>mquery</code> supports specifying <a href="https://www.mongodb.com/docs/manual/core/read-preference/">Read Preferences</a> to control from which MongoDB node your query will read.
The Read Preferences spec also support specifying tags. To pass tags, some
drivers (Node.js driver) require passing a special constructor that handles both the read preference and its tags.
If you need to specify tags, pass an instance of your drivers ReadPreference constructor or roll your own. <code>mquery</code> will store whatever you provide and pass later to your collection during execution.</p>
<h2 id="future-goals">Future goals</h2>
<ul>
<li>mongo shell compatibility</li>
<li>browser compatibility</li>
</ul>
<h2 id="installation">Installation</h2>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>npm<span class="w"> </span>install<span class="w"> </span>mquery
</span></code></pre></div>
<h2 id="license">License</h2>
<p><a href="https://github.com/aheckmann/mquery/blob/master/LICENSE">MIT</a></p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Copyright &copy; 2025 - 2025 Nazmul Alam</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/diptu/system-design-multilang" class="fa fa-code-fork" style="color: #fcfcfc"> diptu/system-design-multilang</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../../../../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../../../../..";</script>
    <script src="../../../../../../js/theme_extra.js"></script>
    <script src="../../../../../../js/theme.js"></script>
      <script src="../../../../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
